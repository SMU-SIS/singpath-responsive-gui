<!DOCTYPE html>
<html lang="en" ng-app="myApp">
<head>
<title>Stats Controller Usage Examples</title>

<style>
th, td { padding: 2px }
</style>

</head>

<body>
  <h3>This page will simulate all the different ways to start games.</h3>
  Todo:
  <ul>
    <li>Sum Errors, Timeouts, Pass, Fail</li>
    <li>Fetch additional records from the API</li>
    <li>Verify Requests Pie Chart by url</li>
    <li>Verify Requests Stacked Bar Chart Result by Verifier</li>
    <li>Player Percentiles Sortable Table</li>
    <li>Problem Percentiles</li>
    <li>Badge Awards</li>
    <li>Players</li>
  </ul>

<div ng-controller="CohortAnalysisController">
  <h3> Daily Cohort Analysis</h3>
  <input type="submit" value="Fetch Player Events" ng-click="get_players();">
  <input type="submit" value="Analyze Player Events" ng-show="keys(player_events).length==players.length" ng-click="analyze_player_events();">
    {{players.length}} players to analyze<br>
    Fetched events for {{keys(player_events).length}}/{{players.length}}<br>
    Check: {{keys(player_events).length==players.length}}<br>
    <select ng-model="event" ng-options="k as k for (k,v) in event_list"></select>
      Seleted Event: {{event}} 
        
    Events: <!--{{cohort_event_count}}-->
    <hr>
    <b>Not implemented yet </b>
    Country <select ng-model="countryCode" ng-options="code as code for (code,name) in countryCodes"></select>
      countryCode: {{countryCode}} <br>
        
    
    <table>
      <tr>
        <th>Join Date (players)</th>
        <th>Cohort Return Rate </th>
        <th ng-repeat="header in [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]">
          {{header}}
        </th>
      </tr>
      <tr ng-repeat="(join_day, theDaysLater) in cohort_event_count[event]">
          <td>{{join_day}} ({{players_by_join_day[join_day].length}})</td>
          <td><b>{{return_vist_count[join_day]/players_by_join_day[join_day].length * 100 | number:2}}%</b></td>
          <td ng-repeat="days_later in [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]">
          <!--<td ng-repeat="(days_later,theEvents) in theDaysLater">-->
            <span ng-show="keys(theDaysLater[days_later]).length>0">{{(keys(theDaysLater[days_later]).length/players_by_join_day[join_day].length)*100 | number:2}}% ({{keys(theDaysLater[days_later]).length}})
            </span>
          </td>
      </tr>

    </table>
    Average Return Rate {{average_return_rate | number:2}}%<br>
    Weighted Return Rate <b>{{total_returns_percentage | number:2}}%</b><br>

    Event list = {{event_list}}<br>
    
</div>

<div ng-controller="GenericRestController" ng-init="model='verifyrequest'">
   
  Managing VerifyRequest using the Generic Controller<br>
  Verify Requests:<br>
  
    <input type="submit" value="Append List" ng-click="append_list();">
    {{items.length}} verifyrequests to analyze
    <div ng-controller="VerifyRequestController">
  
      <input type="submit" value="Analyze" ng-click="analyze();"><br>
      Showing from {{items[0].response_time}} to {{items[items.length-1].response_time}}   
      <ol>
        <li ng-repeat="(k,v) in result">
         {{k}} has {{result[k].vrs.length}} entries. <br>
         TIMEOUT {{result[k].TIMEOUT}}<br>
         ERROR {{result[k].ERROR}} <br>
         PASS {{result[k].PASS}} <br>
         FAIL {{result[k].FAIL}}<br>
         PRIVATE_FAIL {{result[k].PRIVATE_FAIL}}
        </li>
      </ol>
      <div ng-repeat="(k,v) in result">
        <ol>
          Details for <b>{{k}}</b>
          <li ng-repeat="entry in result[k].vrs" ng-show="entry.result=='ERROR'">
          {{entry.result}}, seconds {{entry.microseconds/1000000.0}}, {{entry.url}} , response_time {{entry.response_time}}, response <pre>{{entry.response.errors}}</pre>
          </li>
        </ol>
      </div>

    </div>
  </div>

  <div ng-controller="GameResultController" ng-init="model='gameresult';">
    
    Game Results: Count {{items.length}}<br>
    <input type="submit" value="Analyze 100 More Game Results" ng-click="append_list()">

    Analysis:
    
    <ol>
      <li ng-repeat="(k,v) in analysis">
        On {{k}} a total of {{v.players.length}} players spent {{v.attempts}} attempts and {{v.solve_time/3600 | number:2}} hours solving problems.
      </li>
    </ol>
    
    <!--
    <ol>
      <li ng-repeat="entry in items">
        result {{entry.result}}, attempts {{entry.attempts}}, solve_time {{entry.solve_time}}, problem {{entry.problem}}, player {{entry.player}}, game {{entry.game}}, {{entry.game_start}}, LOC {{entry.loc}}, day {{entry.game_start.split('T')[0]}}, time {{entry.game_start.split('T')[1]}}
      </li>
    </ol>
  -->
    
  </div>
  <div ng-controller="JsonRecordController" ng-init="fetch();">
   
    <table>
      <tr><th ng-repeat="header in ['Date', 'DAU', 'MAU', 'DAU/MAU']">
          {{header}}</th>
      </tr>
      <tr ng-repeat="(k,v) in items.daus">
          <td>{{k}}</td>
          <td>{{v}}</td>
          <td>{{items.maus[k]}}</td>
          <td>{{items.daumaus[k]*100 | number:2}}%</td>
      </tr>
    </table>     
    <ol>
      <li ng-repeat="(k,v) in items.daus">
          Date {{k}}, DAU {{v}}, MAU {{items.maus[k]}}, DAUMAU {{items.daumaus[k]*100 | number:2}}%
      </li>
    </ol>

  </div>



  <div ng-controller="GenericRestController" ng-init="model='playerpercentiles';">
    
    PlayerPercentiles: {{items.length}}<br>
    <input type="submit" value="Append List" ng-click="append_list()"><br>
    <table>
      <tr><th ng-repeat="header in headers">
          <a ng-click="$parent.sortColumn=headers[$index];$parent.reverse=!$parent.reverse">{{ headers[$index] }}</a></th>
      </tr>
      <tr ng-repeat="arr in items | orderBy:sortColumn:reverse">
          <td ng-repeat="val in arr" ng-bind-html-unsafe="arr[headers[$index]]"></td>
      </tr>
    </table>    
  </div>

  <div ng-controller="GenericRestController" ng-init="model='problempercentiles';">
    
    ProblemPercentiles: {{items.length}}<br>
    <input type="submit" value="Append List" ng-click="append_list()"><br>
    
    <table>
      <tr><th ng-repeat="header in headers">
          <a ng-click="$parent.sortColumn=headers[$index];$parent.reverse=!$parent.reverse">{{ headers[$index] }}</a></th>
      </tr>
      <tr ng-repeat="arr in items | orderBy:sortColumn:reverse">
          <td ng-repeat="val in arr" ng-bind-html-unsafe="arr[headers[$index]]"></td>
      </tr>
    </table>
    
  </div>

  <div ng-controller="GenericRestController" ng-init="model='players';">
    
    Players: {{items.length}}<br>
    <input type="submit" value="List" ng-click="append_list()"><br>
    
    <ol>
      <li ng-repeat="entry in items">
          {{entry}}
      </li>
    </ol>
    
  </div>

    <div ng-controller="GenericRestController" ng-init="model='challengetracking';">
    
    Challenge Tracking: {{items.length}}<br>
    <input type="submit" value="List" ng-click="append_list()"><br>
    
    <ol>
      <li ng-repeat="entry in items">
         {{entry}}, player {{entry.player}}, challenge {{entry.challenge}}
         <div ng-controller="GenericRestController" ng-init="model='player';load(entry.player)">player {{item}}
         </div>
      </li>
    </ol>
    
  </div>

<script src="../lib/angular/angular.min.js"></script>
<script src="../lib/angular/angular-resource.min.js"></script>
<script src="../js/controllers.js"></script>  
<script src="../js/analytics.js"></script>
<script src="../js/app-config.js"></script>          
<script src="../js/app.js"></script>    
<!-- <script src="../../test/app-test.js"></script>  -->
<!-- This data will only be on Chris' local machine -->
<script src="../../../local-app-test.js"></script>    
<!-- End -->
<script src="../../test/lib/angular/angular-mocks.js"></script>    

</body>
</html>